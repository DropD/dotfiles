set -o vi

## If not running interactively, don't do anything
#case $- in
#    *i*) ;;
#      *) return;;
#esac

## editor, prefer nvim / vimr if found on the path, fall back to vim / gvim
EDITOR=vim && [ -x $(command -v nvim) ] && EDITOR=vim
VISUAL=gvim && [ -x $(command -v vimr) ] && VISUAL=vimr

# don't put duplicate lines or lines starting with space in the history.
# See bash(1) for more options
HISTCONTROL=ignoreboth

# append to the history file, don't overwrite it
shopt -s histappend

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

## miniconda setup
if [ -d "${HOME}/miniconda3" ]; then
    export PATH=~/miniconda3/bin:"$PATH"
    has_conda=true
elif [ -d "${HOME}/miniconda" ]; then
    export PATH=~/miniconda/bin:"$PATH"
    has_conda=true
fi
has_conda=false && [ -x "$(command -v conda)"] && has_conda=true
if [ $has_conda ]; then
    eval "$(register-python-argcomplete conda)"
fi

## bash completion (powerd by homebrew)
if [ -f $(brew --prefix)/etc/bash_completion ]; then
  . $(brew --prefix)/etc/bash_completion
fi

## aliases
alias_dir="${HOME}/.config/bash/alias"
if [ -d $alias_dir ]; then
    shopt -s nullglob
    for alias_file in ${alias_dir}/*.sh; do
        source $alias_file
    done
    shopt -u nullglob
fi

## local path additions
path_dir="${HOME}/.config/bash/path"
if [ -d $path_dir ]; then
    shopt -s nullglob
    for path_file in ${path_dir}/*.sh; do
	source $path_file
    done
    shopt -u nullglob
fi

## local bashrc
lbashrc="${HOME}/.config/bash/local_bashrc"
if [ -f $lbashrc ]; then
    source $lbashrc
fi

# enable fs colors
export CLICOLOR=1
  
function prompt_command {
if [[ $PWD = */Prog* ]]; then
    export WCOL="1;32"
elif [[ $PWD = */EPFL* ]]; then
    export WCOL="0;32"
elif [[ $PWD = /usr* ]]; then
    export WCOL="1;31"
else
    export WCOL="0;37"
fi
if [[ $HOSTNAME = *monch* ]]; then
    export HCOL="0;31"
else 
    export HCOL="0;34"
fi
}

export PROMPT_COMMAND=prompt_command
export PS1="\[\e[\$(echo -n \$HCOL)m\]\h:\[\e[\$(echo -n \$WCOL)m\]\W \[\e[0;33m\]\u\[\e[0m\]\$ "
